<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matriz GE-McKinsey Din√°mica - Editor Universal</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header">
    <div class="editable-title">
      <h1 id="main-title" onclick="editTitle('main-title')">üè¢ Matriz GE-McKinsey Din√°mica - Carvajal S.A.</h1>
      <input type="text" id="main-title-edit" class="title-edit" onblur="saveTitle('main-title')" onkeypress="saveTitleOnEnter(event, 'main-title')">
    </div>
    <div class="editable-title">
      <div class="subtitle" id="subtitle" onclick="editTitle('subtitle')">An√°lisis Estrat√©gico del Portfolio Tecnol√≥gico ‚Ä¢ Versi√≥n 2024-2027</div>
      <input type="text" id="subtitle-edit" class="title-edit" onblur="saveTitle('subtitle')" onkeypress="saveTitleOnEnter(event, 'subtitle')">
    </div>
  </div>

  <div class="main-container">
    <div class="control-panel">
      <!-- Fila 1: Tablas de Evaluaci√≥n lado a lado -->
      <div class="tables-row" style="display: flex; gap: 20px; margin-bottom: 30px;">
        <!-- Tabla de Evaluaci√≥n - Factores Internos -->
        <div class="table-section" style="flex: 1; min-width: 0;">
          <h3>üè¢ Factores Internos (Fortalezas)</h3>
          <div style="margin-bottom: 10px;">
            <button class="btn btn-success btn-sm" onclick="addInternalFactor()">+ Factor</button>
            <button class="btn btn-primary btn-sm" onclick="addProductRow()">+ Producto</button>
          </div>
          <div style="overflow-x: auto;">
            <table id="internal-evaluation-table" class="evaluation-table">
              <thead>
                <tr>
                  <th rowspan="2" style="vertical-align: middle;">Producto</th>
                  <th colspan="5">Factores Internos</th>
                  <th rowspan="2" style="vertical-align: middle;">Coord. X</th>
                  <th rowspan="2" style="vertical-align: middle;">Acciones</th>
                </tr>
                <tr id="internal-factors-header">
                  <th>
                    <div>Liderazgo Tecnol√≥gico</div>
                    <input type="number" class="factor-weight" value="25" min="0" max="100" onchange="updateInternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Disponibilidad Plataformas</div>
                    <input type="number" class="factor-weight" value="20" min="0" max="100" onchange="updateInternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Base Clientes B2B</div>
                    <input type="number" class="factor-weight" value="20" min="0" max="100" onchange="updateInternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Experiencia Regional</div>
                    <input type="number" class="factor-weight" value="15" min="0" max="100" onchange="updateInternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Capacidad Innovaci√≥n</div>
                    <input type="number" class="factor-weight" value="20" min="0" max="100" onchange="updateInternalCalculations()" style="width: 50px;">%
                  </th>
                </tr>
              </thead>
              <tbody id="internal-products-tbody">
                <!-- Las filas de productos se generar√°n din√°micamente -->
              </tbody>
              <tfoot>
                <tr>
                  <th>Total Pesos:</th>
                  <th colspan="5" id="internal-weights-total" style="color: #28a745;">100%</th>
                  <th></th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- Tabla de Evaluaci√≥n - Factores Externos -->
        <div class="table-section" style="flex: 1; min-width: 0;">
          <h3>üåç Factores Externos (Atractivo)</h3>
          <div style="margin-bottom: 10px;">
            <button class="btn btn-success btn-sm" onclick="addExternalFactor()">+ Factor</button>
          </div>
          <div style="overflow-x: auto;">
            <table id="external-evaluation-table" class="evaluation-table">
              <thead>
                <tr>
                  <th rowspan="2" style="vertical-align: middle;">Producto</th>
                  <th colspan="4">Factores Externos</th>
                  <th rowspan="2" style="vertical-align: middle;">Coord. Y</th>
                  <th rowspan="2" style="vertical-align: middle;">Acciones</th>
                </tr>
                <tr id="external-factors-header">
                  <th>
                    <div>Transformaci√≥n Digital</div>
                    <input type="number" class="factor-weight" value="30" min="0" max="100" onchange="updateExternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Crecimiento Fintech</div>
                    <input type="number" class="factor-weight" value="25" min="0" max="100" onchange="updateExternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Regulaciones Favorables</div>
                    <input type="number" class="factor-weight" value="20" min="0" max="100" onchange="updateExternalCalculations()" style="width: 50px;">%
                  </th>
                  <th>
                    <div>Demanda B2B Colombia</div>
                    <input type="number" class="factor-weight" value="25" min="0" max="100" onchange="updateExternalCalculations()" style="width: 50px;">%
                  </th>
                </tr>
              </thead>
              <tbody id="external-products-tbody">
                <!-- Las filas de productos se generar√°n din√°micamente -->
              </tbody>
              <tfoot>
                <tr>
                  <th>Total Pesos:</th>
                  <th colspan="4" id="external-weights-total" style="color: #28a745;">100%</th>
                  <th></th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- Fila 2: Fechas y Controles -->
      <div class="controls-row" style="display: flex; gap: 20px; margin-bottom: 20px;">

        <!-- Controles -->
        <div class="section" style="flex: 1;">
          <h3>üéõÔ∏è Controles</h3>
          <div class="controls" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <!--<button class="btn btn-sm" onclick="showAllYears()">üìä Ver Todos</button>-->
            <button class="btn btn-secondary btn-sm" onclick="exportMatrix()">üíæ Exportar</button>
            <!--<button class="btn btn-sm" onclick="showProjectionModal()">‚è≠Ô∏è Proyecciones</button>-->
            <button class="btn btn-secondary btn-sm" onclick="animateMovements()">üé¨ Animar</button>
          </div>
          <div class="year-filter" id="year-filter" style="margin-top: 10px;">
            <!-- Los botones de filtro se generar√°n din√°micamente -->
          </div>
        </div>
      </div>

      <!-- Fila 3: Selector de Color y Leyenda -->
      <div class="color-row" style="display: flex; gap: 20px; margin-bottom: 20px;">
        <!-- Selector de Color -->
        <div class="section" style="flex: 2;">
          <h3>üé® Colores de Productos</h3>
          <div class="color-picker-section">
            <div style="display: flex; gap: 15px; margin-bottom: 15px; align-items: center;">
              <div style="flex: 1;">
                <label for="product-selector" style="display: block; margin-bottom: 5px; font-weight: bold;">Seleccionar Producto:</label>
                <select id="product-selector" class="product-select" onchange="updateSelectedProduct()">
                  <option value="">-- Seleccionar producto --</option>
                </select>
              </div>
              <div style="flex: 1;">
                <label for="color-selector" style="display: block; margin-bottom: 5px; font-weight: bold;">Seleccionar Color:</label>
                <select id="color-selector" class="color-select" onchange="applySelectedColor()">
                  <option value="">-- Seleccionar color --</option>
                  <option value="#10b981" style="background: #10b981; color: white;">üü¢ Verde - Invertir/Crecer</option>
                  <option value="#f59e0b" style="background: #f59e0b; color: white;">üü° Amarillo - Selectividad</option>
                  <option value="#ef4444" style="background: #ef4444; color: white;">üî¥ Rojo - Cosechar/Retirar</option>
                  <option value="#3b82f6" style="background: #3b82f6; color: white;">üîµ Azul</option>
                  <option value="#8b5cf6" style="background: #8b5cf6; color: white;">üü£ P√∫rpura</option>
                  <option value="#06b6d4" style="background: #06b6d4; color: white;">ü©µ Cian</option>
                  <option value="#f97316" style="background: #f97316; color: white;">üü† Naranja</option>
                  <option value="#84cc16" style="background: #84cc16; color: white;">üü¢ Lima</option>
                  <option value="#ec4899" style="background: #ec4899; color: white;">ü©∑ Rosa</option>
                  <option value="#6b7280" style="background: #6b7280; color: white;">‚ö´ Gris</option>
                </select>
              </div>
            </div>
            
            <div class="custom-color-input">
              <label>Color personalizado:</label>
              <input type="color" id="custom-color" value="#2c5aa0">
              <button class="btn btn-sm" onclick="applyCustomColorToSelected()">Aplicar</button>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 5px; border: 1px solid #2c5aa0;">
              <strong>Producto actual:</strong> <span id="selected-product-display">Ninguno seleccionado</span><br>
              <strong>Color actual:</strong> <span id="selected-color-display" style="display: inline-block; width: 20px; height: 20px; border-radius: 50%; border: 1px solid #ccc; margin-left: 5px;"></span>
            </div>
            
            <p style="font-size: 10px; color: #666; margin-top: 10px;">
              üí° Selecciona un producto y un color de las listas desplegables
            </p>
          </div>
        </div>

        <!-- Tabla de Ventas y Participaci√≥n -->
        <div class="section" style="flex: 2;">
          <h3>üí∞ Ventas y Participaci√≥n</h3>
          <div style="overflow-x: auto;">
            <table class="evaluation-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Ventas ($)<br><small style="font-weight: normal;">70% del tama√±o</small></th>
                  <th>Participaci√≥n (%)<br><small style="font-weight: normal;">30% del tama√±o</small></th>
                  <th>Tama√±o Burbuja<br><small style="font-weight: normal;">% del m√°ximo</small></th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="sales-table-body">
                <!-- Las filas se generar√°n din√°micamente -->
              </tbody>
              <tfoot>
                <tr style="background: #f8f9fa; font-weight: bold;">
                  <th>Total:</th>
                  <th id="total-sales">$0</th>
                  <th id="total-share">0%</th>
                  <th>-</th>
                  <th>-</th>
                </tr>
              </tfoot>
            </table>
          </div>
          <div style="margin-top: 10px;">
            <button class="btn btn-primary btn-sm" onclick="addProductToSalesTable()">+ Agregar Producto</button>
          </div>
          <p style="font-size: 10px; color: #666; margin-top: 10px;">
            üí° <strong>Tama√±o Burbuja =</strong> Ventas (70%) + Participaci√≥n (30%) - Los cambios se reflejan autom√°ticamente en la matriz
          </p>
        </div>

        <!-- Leyenda -->
        <div class="section" style="flex: 1;">
          <h4 style="margin-top: 0; color: #2c5aa0">üóùÔ∏è Leyenda</h4>
          <div class="legend-item">
            <div class="legend-color" style="background: #10b981"></div>
            <span>Invertir/Crecer</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #f59e0b"></div>
            <span>Selectividad</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ef4444"></div>
            <span>Cosechar/Retirar</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #94a3b8; border: 2px dashed #666"></div>
            <span>Proyecci√≥n futura</span>
          </div>
          <div style="margin-top: 15px; font-size: 12px; color: #666;">
            <strong>Tama√±o de c√≠rculo:</strong><br>
            Proporcional al % de participaci√≥n de mercado
          </div>
        </div>
      </div>
    </div>

    <div class="matrix-container">
      <svg id="matrix-svg" viewBox="0 0 1000 600"></svg>
    </div>
  </div>

  <!-- Tooltip -->
  <div id="tooltip" class="tooltip"></div>

  <!-- Panel de Gesti√≥n de Datos -->
  <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 2px solid #2c5aa0;">
      <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 14px;">üíæ Gesti√≥n de Datos</h4>
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button class="btn btn-sm" onclick="saveToLocalStorage()" style="font-size: 12px;">
          üíæ Guardar Manual
        </button>
        <button class="btn btn-sm" onclick="exportData()" style="font-size: 12px;">
          üì• Exportar JSON
        </button>
        <input type="file" id="importFile" accept=".json" onchange="importData(this)" style="display: none;">
        <button class="btn btn-sm" onclick="document.getElementById('importFile').click()" style="font-size: 12px;">
          üì§ Importar JSON
        </button>
        <button class="btn btn-sm" onclick="clearLocalStorage()" style="font-size: 12px; background: #dc3545; color: white;">
          üóëÔ∏è Resetear Todo
        </button>
      </div>
      <p style="font-size: 10px; color: #666; margin: 8px 0 0 0;">
        Auto-guardado activo ‚úÖ
      </p>
    </div>
  </div>

  <!-- Modal Proyecciones -->
  <div id="projectionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 style="margin: 0; color: #2c5aa0">‚è≠Ô∏è Editar Proyecciones Estrat√©gicas</h3>
        <span class="close" onclick="closeProjectionModal()">√ó</span>
      </div>
      <div id="projectionForm" class="projection-form"></div>
      <div style="text-align: right; margin-top: 20px">
        <button class="btn" onclick="saveProjections()">üíæ Guardar</button>
        <button class="btn btn-secondary" onclick="closeProjectionModal()">‚ùå Cancelar</button>
      </div>
    </div>
  </div>

  <!-- JavaScript al final -->
  <script>
    // Todas las variables y funciones est√°n en script.js - v5.0
  </script>
  <script src="script.js?v=5.0"></script> <!-- Funciones completas + flechas din√°micas + gr√°fico torta -->
</body>
</html>